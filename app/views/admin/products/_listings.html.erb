<h2 class="text-xl font-semibold mb-4">NPC Listings</h2>
<div>
<%= form_with model: [ :admin, @product, ProductListing.new ], local: true do |form| %>
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
    <div>
      <%= form.label :npc_type, "NPC Type", class: "block text-sm font-medium text-gray-700" %>
      <%= form.text_field :npc_type, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm" %>
    </div>
    <div>
      <%= form.label :city_id, "City", class: "block text-sm font-medium text-gray-700" %>
      <%= form.select :city_id, City.all.map { |c| [c.name, c.id] }, include_blank: true, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm" %>
    </div>
    <div>
      <%= form.label :shard_id, "Shard", class: "block text-sm font-medium text-gray-700" %>
      <%= form.select :shard_id, Shard.all.map { |s| [s.name, s.id] }, include_blank: true, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm" %>
    </div>
    <div>
      <%= form.label :override_price, "Override Price", class: "block text-sm font-medium text-gray-700" %>
      <%= form.number_field :override_price, step: 0.01, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm sm:text-sm" %>
    </div>
  </div>
  <div class="flex justify-end">
    <%= form.submit "Add Listing", class: "bg-green-600 text-white px-4 py-2 rounded" %>
  </div>
<% end %>
</div>

<% if @product.product_listings.any? %>
  <table class="mt-6 w-full text-left border rounded overflow-hidden">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-2">NPC Type</th>
        <th class="px-4 py-2">City</th>
        <th class="px-4 py-2">Shard</th>
        <th class="px-4 py-2">Override Price</th>
        <th class="px-4 py-2">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @product.product_listings.each do |listing| %>
        <tr class="border-t">
          <td class="px-4 py-2"><%= listing.npc_type %></td>
          <td class="px-4 py-2"><%= listing.city&.name || "Any" %></td>
          <td class="px-4 py-2"><%= listing.shard&.name || "Any" %></td>
          <td class="px-4 py-2"><%= number_to_currency(listing.override_price) if listing.override_price.present? %></td>
          <td class="px-4 py-2">
            <%= button_to "Remove", admin_product_product_listing_path(@product, listing), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "text-red-600 hover:underline" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
